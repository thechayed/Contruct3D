"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[832],{4832:(e,s,t)=>{t.d(s,{TDSLoader:()=>i});var a=t(9451);class i extends a.Loader{constructor(e){super(e),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(e,s,t,i){const r=this,d=""===this.path?a.LoaderUtils.extractUrlBase(e):this.path,n=new a.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(function(t){try{s(r.parse(t,d))}catch(s){i?i(s):console.error(s),r.manager.itemError(e)}}),t,i)}parse(e,s){this.group=new a.Group,this.materials=[],this.meshes=[],this.readFile(e,s);for(let e=0;e<this.meshes.length;e++)this.group.add(this.meshes[e]);return this.group}readFile(e,s){const t=new DataView(e),a=new r(t,0,this.debugMessage);if(a.id===n||a.id===o||a.id===d){let e=a.readChunk();for(;e;){if(e.id===h){const s=e.readDWord();this.debugMessage("3DS file version: "+s)}else e.id===f?this.readMeshData(e,s):this.debugMessage("Unknown main chunk: "+e.hexId);e=a.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,s){let t=e.readChunk();for(;t;){if(t.id===b){const e=+t.readDWord();this.debugMessage("Mesh Version: "+e)}else if(t.id===m){const e=t.readFloat();this.debugMessage("Master scale: "+e),this.group.scale.set(e,e,e)}else t.id===R?(this.debugMessage("Named Object"),this.readNamedObject(t)):t.id===k?(this.debugMessage("Material"),this.readMaterialEntry(t,s)):this.debugMessage("Unknown MDATA chunk: "+t.hexId);t=e.readChunk()}}readNamedObject(e){const s=e.readString();let t=e.readChunk();for(;t;){if(t.id===V){const e=this.readMesh(t);e.name=s,this.meshes.push(e)}else this.debugMessage("Unknown named object chunk: "+t.hexId);t=e.readChunk()}}readMaterialEntry(e,s){let t=e.readChunk();const i=new a.MeshPhongMaterial;for(;t;){if(t.id===C)i.name=t.readString(),this.debugMessage("   Name: "+i.name);else if(t.id===U)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(t.id===D){const e=t.readByte();i.wireframeLinewidth=e,this.debugMessage("   Wireframe Thickness: "+e)}else if(t.id===B)i.side=a.DoubleSide,this.debugMessage("   DoubleSided");else if(t.id===S)this.debugMessage("   Additive Blending"),i.blending=a.AdditiveBlending;else if(t.id===w)this.debugMessage("   Diffuse Color"),i.color=this.readColor(t);else if(t.id===F)this.debugMessage("   Specular Color"),i.specular=this.readColor(t);else if(t.id===y)this.debugMessage("   Ambient color"),i.color=this.readColor(t);else if(t.id===x){const e=this.readPercentage(t);i.shininess=100*e,this.debugMessage("   Shininess : "+e)}else if(t.id===W){const e=this.readPercentage(t);i.opacity=1-e,this.debugMessage("  Transparency : "+e),i.transparent=i.opacity<1}else t.id===I?(this.debugMessage("   ColorMap"),i.map=this.readMap(t,s)):t.id===O?(this.debugMessage("   BumpMap"),i.bumpMap=this.readMap(t,s)):t.id===A?(this.debugMessage("   OpacityMap"),i.alphaMap=this.readMap(t,s)):t.id===P?(this.debugMessage("   SpecularMap"),i.specularMap=this.readMap(t,s)):this.debugMessage("   Unknown material chunk: "+t.hexId);t=e.readChunk()}this.materials[i.name]=i}readMesh(e){let s=e.readChunk();const t=new a.BufferGeometry,i=new a.MeshPhongMaterial,r=new a.Mesh(t,i);for(r.name="mesh";s;){if(s.id===j){const e=s.readWord();this.debugMessage("   Vertex: "+e);const i=[];for(let t=0;t<e;t++)i.push(s.readFloat()),i.push(s.readFloat()),i.push(s.readFloat());t.setAttribute("position",new a.Float32BufferAttribute(i,3))}else if(s.id===z)this.readFaceArray(s,r);else if(s.id===E){const e=s.readWord();this.debugMessage("   UV: "+e);const i=[];for(let t=0;t<e;t++)i.push(s.readFloat()),i.push(s.readFloat());t.setAttribute("uv",new a.Float32BufferAttribute(i,2))}else if(s.id===H){this.debugMessage("   Tranformation Matrix (TODO)");const e=[];for(let t=0;t<12;t++)e[t]=s.readFloat();const i=new a.Matrix4;i.elements[0]=e[0],i.elements[1]=e[6],i.elements[2]=e[3],i.elements[3]=e[9],i.elements[4]=e[2],i.elements[5]=e[8],i.elements[6]=e[5],i.elements[7]=e[11],i.elements[8]=e[1],i.elements[9]=e[7],i.elements[10]=e[4],i.elements[11]=e[10],i.elements[12]=0,i.elements[13]=0,i.elements[14]=0,i.elements[15]=1,i.transpose();const d=new a.Matrix4;d.copy(i).invert(),t.applyMatrix4(d),i.decompose(r.position,r.quaternion,r.scale)}else this.debugMessage("   Unknown mesh chunk: "+s.hexId);s=e.readChunk()}return t.computeVertexNormals(),r}readFaceArray(e,s){const t=e.readWord();this.debugMessage("   Faces: "+t);const a=[];for(let s=0;s<t;++s)a.push(e.readWord(),e.readWord(),e.readWord()),e.readWord();s.geometry.setIndex(a);let i=0,r=0;for(;!e.endOfChunk;){const t=e.readChunk();if(t.id===q){this.debugMessage("      Material Group");const e=this.readMaterialGroup(t),a=3*e.index.length;s.geometry.addGroup(r,a,i),r+=a,i++;const d=this.materials[e.name];!1===Array.isArray(s.material)&&(s.material=[]),void 0!==d&&s.material.push(d)}else this.debugMessage("      Unknown face array chunk: "+t.hexId)}1===s.material.length&&(s.material=s.material[0])}readMap(e,s){let t=e.readChunk(),i={};const r=new a.TextureLoader(this.manager);for(r.setPath(this.resourcePath||s).setCrossOrigin(this.crossOrigin);t;){if(t.id===G){const e=t.readString();i=r.load(e),this.debugMessage("      File: "+s+e)}else t.id===v?(i.offset.x=t.readFloat(),this.debugMessage("      OffsetX: "+i.offset.x)):t.id===N?(i.offset.y=t.readFloat(),this.debugMessage("      OffsetY: "+i.offset.y)):t.id===L?(i.repeat.x=t.readFloat(),this.debugMessage("      RepeatX: "+i.repeat.x)):t.id===T?(i.repeat.y=t.readFloat(),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+t.hexId);t=e.readChunk()}return i}readMaterialGroup(e){const s=e.readString(),t=e.readWord();this.debugMessage("         Name: "+s),this.debugMessage("         Faces: "+t);const a=[];for(let s=0;s<t;++s)a.push(e.readWord());return{name:s,index:a}}readColor(e){const s=e.readChunk(),t=new a.Color;if(s.id===g||s.id===l){const e=s.readByte(),a=s.readByte(),i=s.readByte();t.setRGB(e/255,a/255,i/255),this.debugMessage("      Color: "+t.r+", "+t.g+", "+t.b)}else if(s.id===u||s.id===c){const e=s.readFloat(),a=s.readFloat(),i=s.readFloat();t.setRGB(e,a,i),this.debugMessage("      Color: "+t.r+", "+t.g+", "+t.b)}else this.debugMessage("      Unknown color chunk: "+s.hexId);return t}readPercentage(e){const s=e.readChunk();switch(s.id){case p:return s.readShort()/100;case M:return s.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+s.hexId),0}}debugMessage(e){this.debug&&console.log(e)}}class r{constructor(e,s,t){this.data=e,this.offset=s,this.position=s,this.debugMessage=t,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>e.byteLength&&this.debugMessage("Bad chunk size for chunk at "+s)}readChunk(){if(this.endOfChunk)return null;try{const e=new r(this.data,this.position,this.debugMessage);return this.position+=e.size,e}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const e=this.data.getUint8(this.position,!0);return this.position+=1,e}readFloat(){try{const e=this.data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){return this.debugMessage(e+" "+this.position+" "+this.data.byteLength),0}}readInt(){const e=this.data.getInt32(this.position,!0);return this.position+=4,e}readShort(){const e=this.data.getInt16(this.position,!0);return this.position+=2,e}readDWord(){const e=this.data.getUint32(this.position,!0);return this.position+=4,e}readWord(){const e=this.data.getUint16(this.position,!0);return this.position+=2,e}readString(){let e="",s=this.readByte();for(;s;)e+=String.fromCharCode(s),s=this.readByte();return e}}const d=19789,n=15786,o=49725,h=2,u=16,g=17,l=18,c=19,p=48,M=49,f=15677,b=15678,m=256,k=45055,C=40960,y=40976,w=40992,F=41008,x=41024,W=41040,B=41089,S=41091,U=41093,D=41095,I=41472,A=41488,O=41520,P=41476,G=41728,L=41812,T=41814,v=41816,N=41818,R=16384,V=16640,j=16656,z=16672,q=16688,E=16704,H=16736}}]);